---
layout: post
title: Vue3 ç©¶ç«Ÿå¥½åœ¨å“ªé‡Œï¼Ÿï¼ˆå’Œ React Hook çš„è¯¦ç»†å¯¹æ¯”ï¼‰
date: 2019-11-20 
tags: VUE.js 
---

## å‰è¨€

è¿™å‡ å¤© Vue 3.0 Beta ç‰ˆæœ¬å‘å¸ƒäº†ï¼Œæœ¬ä»¥ä¸ºæ˜¯çš†å¤§æ¬¢å–œçš„ä¸€ä»¶äº‹æƒ…ï¼Œä½†æ˜¯è®ºå›é‡Œè¿˜æ˜¯çœ‹åˆ°äº†å¾ˆå¤šåå¯¹çš„å£°éŸ³ã€‚ä¸»æµçš„åå¯¹è®ºç‚¹å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š

1. æ„å¤§åˆ©é¢ä»£ç ç»“æ„åæ§½ï¼š

> â€œå¤ªå¤±æœ›äº†ã€‚æ‚ä¸ƒæ‚å…«ä¸€å †ä¸¢åœ¨ setup é‡Œï¼Œæˆ‘è¿˜ä¸å¦‚ç›´æ¥ç”¨ reactâ€

> æˆ‘çš„å¤©ï¼Œ3.0 è¿™ä¹ˆæçš„è¯ï¼Œä»£ç ç»“æ„ä¸æ¸…æ™°ï¼Œè¯­ä¹‰ä¸æ˜ç¡®ï¼Œæ— å¼‚äºæŠŠ vue è‡ªèº«ä¼˜ç‚¹éƒ½æ‰”äº†

> æ€ä¹ˆæ„Ÿè§‰ä»£ç ç»“æ„ä¸Šæ²¡æœ‰ 2.0 æ¸…æ™°äº†å‘¢ ğŸ˜‚ è¿™è¦æ˜¯ä»£ç é‡ä¸Šå»äº†æ˜¯ä¸æ˜¯ä¸å¥½ç»´æŠ¤å•Š

1. æŠ„è¢­ React åæ§½ï¼š

> æŠ„æ¥æŠ„å»æ²¡è‡ªå·±çš„ä¸ªæ€§

> æœ‰ react é¦™å—ï¼Ÿè¶Šæ¥è¶Šåƒ react äº†

åœ¨æˆ‘çœ‹æ¥ï¼ŒVue é»‘æš—çš„ä¸€å¤©è¿˜è¿œè¿œæ²¡æœ‰è¿‡å»ï¼Œå¾ˆå¤šäººå…¶å®å¹¶æ²¡æœ‰è®¤çœŸçš„å»çœ‹ `Vue-Composition-Api` æ–‡æ¡£ä¸­çš„ `åŠ¨æœº` ç« èŠ‚ï¼Œæœ¬æ–‡å°±ä»¥[è¿™ä¸ªç« èŠ‚](https://vue-composition-api-rfc.netlify.app/#logic-reuse-code-organization)ä¸ºçº¿ç´¢ï¼Œä» `ä»£ç ç»“æ„`ã€`åº•å±‚åŸç†` ç­‰æ–¹é¢æ¥ä¸€ä¸€æ‰“æ¶ˆå¤§å®¶çš„ä¸€äº›é¡¾è™‘ã€‚

åœ¨æ–‡ç« çš„å¼€å¤´ï¼Œé¦–å…ˆè¦æ ‡æ˜ä¸€ä¸‹ä½œè€…çš„ç«‹åœºï¼Œæˆ‘å¯¹äº React å’Œ Vue éƒ½éå¸¸çš„å–œæ¬¢ã€‚ä»–ä»¬éƒ½æœ‰ç€å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œæœ¬æ–‡ç»æ— å¼•æˆ˜ä¹‹æ„ã€‚ä¸¤ä¸ªæ¡†æ¶éƒ½å¾ˆæ£’ï¼åªæ˜¯å„æœ‰ä¼˜ç¼ºç‚¹è€Œå·²ã€‚React çš„ Immutable å…¶å®ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šç›Šå¤„ï¼Œå¹¶ä¸” Hook çš„æ€è·¯è¿˜æ˜¯ Facebook å›¢é˜Ÿçš„å¤§ä½¬ä»¬é¦–åˆ›çš„ï¼ŒçœŸçš„æ˜¯å¾ˆè®©äººèµå¹çš„è®¾è®¡ï¼Œæˆ‘å¯¹ React 100% è‡´æ•¬ï¼

## è®¾è®¡åŠ¨æœº

å¤§å¦‚ Vue3 è¿™ç§å…¨çƒçƒ­é—¨çš„æ¡†æ¶ï¼Œä»»ä½•ä¸€ä¸ª `breaking-change` çš„è®¾è®¡ä¸€å®šæœ‰å®ƒçš„æ·±æ€ç†Ÿè™‘å’Œæƒè¡¡ï¼Œé‚£ä¹ˆ `composition-api` å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬éœ€è¦é¦–å…ˆæ€è€ƒæ˜ç™½çš„é—®é¢˜ã€‚

é¦–å…ˆæŠ›å‡º Vue2 çš„ä»£ç æ¨¡å¼ä¸‹å­˜åœ¨çš„å‡ ä¸ªé—®é¢˜ã€‚

1. éšç€åŠŸèƒ½çš„å¢é•¿ï¼Œå¤æ‚ç»„ä»¶çš„ä»£ç å˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚ å°¤å…¶å‘ç”Ÿä½ å»æ–°æ¥æ‰‹åˆ«äººçš„ä»£ç æ—¶ã€‚ æ ¹æœ¬åŸå› æ˜¯ Vue çš„ç°æœ‰ API é€šè¿‡ã€Œé€‰é¡¹ã€ç»„ç»‡ä»£ç ï¼Œä½†æ˜¯åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé€šè¿‡é€»è¾‘è€ƒè™‘æ¥ç»„ç»‡ä»£ç æ›´æœ‰æ„ä¹‰ã€‚
2. ç¼ºå°‘ä¸€ç§æ¯”è¾ƒã€Œå¹²å‡€ã€çš„åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´æå–å’Œå¤ç”¨é€»è¾‘çš„æœºåˆ¶ã€‚
3. ç±»å‹æ¨æ–­ä¸å¤Ÿå‹å¥½ã€‚

### é€»è¾‘é‡ç”¨

ç›¸ä¿¡å¾ˆå¤šæ¥è§¦è¿‡ React Hook çš„å°ä¼™ä¼´å·²ç»å¯¹è¿™ç§æ¨¡å¼ä¸‹ç»„ä»¶é—´é€»è¾‘å¤ç”¨çš„ç®€å•æ€§æœ‰äº†ä¸€å®šçš„è®¤çŸ¥ï¼Œè‡ªä» React 16.7 å‘å¸ƒä»¥æ¥ï¼Œç¤¾åŒºæ¶Œç°å‡ºäº†æµ·é‡çš„ Hook è½®å­ï¼Œä»¥åŠä¸»æµçš„ç”Ÿæ€åº“ `react-router`ï¼Œ`react-redux` ç­‰ç­‰å…¨éƒ¨æ‹¥æŠ± Hookï¼Œéƒ½å¯ä»¥çœ‹å‡ºç¤¾åŒºçš„åŒå¥½ä»¬å¯¹äº Hook å¼€å‘æœºåˆ¶çš„èµåŒã€‚

å…¶å®ç»„ä»¶é€»è¾‘å¤ç”¨åœ¨ React ä¸­æ˜¯ç»å†äº†å¾ˆé•¿çš„ä¸€æ®µå‘å±•å†ç¨‹çš„ï¼Œ `mixin` -> `HOC & render-props` -> `Hook`ï¼Œ`mixin` æ˜¯ React ä¸­æœ€æ—©å¯ç”¨çš„ä¸€ç§é€»è¾‘å¤ç”¨æ–¹å¼ï¼Œå› ä¸ºå®ƒçš„ç¼ºç‚¹å®åœ¨æ˜¯[å¤šåˆ°æ•°ä¸æ¸…](https://www.zhihu.com/question/67588479)ï¼Œè€Œåé¢çš„ä¸¤ç§ä¹Ÿæœ‰ç€è‡ªå·±çš„é—®é¢˜ï¼Œæ¯”å¦‚å¢åŠ ç»„ä»¶åµŒå¥—å•Šã€props æ¥æºä¸æ˜ç¡®å•Šç­‰ç­‰ã€‚å¯ä»¥è¯´åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒHook æ˜¯ç›¸å¯¹å®Œç¾çš„ä¸€ç§æ–¹æ¡ˆã€‚

å½“ç„¶ï¼Œæˆ‘çš„ä¸€è´¯é£æ ¼å°±æ˜¯ä¸Šä»£ç å¯¹æ¯”ï¼Œæˆ‘å°±æ‹¿ HOC æ¥è¯´å§ï¼ŒGithub ä¸Šçš„ä¸€ä¸ªçœŸå®çš„å¼€æºé¡¹ç›®é‡Œå°±å‡ºç°äº†è¿™æ ·çš„åœºæ™¯ï¼š

#### HOC å¯¹æ¯” Hook

```
class MenuBar extends React.Component {
  // props é‡Œæ··åˆç€æ¥è‡ªå„ä¸ªHOCä¼ å…¥çš„å±æ€§ï¼Œè¿˜æœ‰çˆ¶ç»„ä»¶ä¼ å…¥çš„å±æ€§ã€‚
  handleClickNew() {
    const readyToReplaceProject = this.props.confirmReadyToReplaceProject(
      this.props.intl.formatMessage(sharedMessages.replaceProjectWarning)
    );
    this.props.onRequestCloseFile();
    if (readyToReplaceProject) {
      this.props.onClickNew(this.props.canSave && this.props.canCreateNew);
    }
    this.props.onRequestCloseFile();
  }
  handleClickRemix() {
    this.props.onClickRemix();
    this.props.onRequestCloseFile();
  }
  handleClickSave() {
    this.props.onClickSave();
    this.props.onRequestCloseFile();
  }
  handleClickSaveAsCopy() {
    this.props.onClickSaveAsCopy();
    this.props.onRequestCloseFile();
  }
}

export default compose(
  // å›½é™…åŒ–
  injectIntl,
  // èœå•
  MenuBarHOC,
  // react-redux
  connect(mapStateToProps, mapDispatchToProps)
)(MenuBar);
å¤åˆ¶ä»£ç 
```

æ²¡é”™ï¼Œè¿™é‡Œç”¨ compose å‡½æ•°ç»„åˆäº†å¥½å‡ ä¸ª HOCï¼Œå…¶ä¸­è¿˜æœ‰ connect è¿™ç§ `æ¥å—å‡ ä¸ªå‚æ•°è¿”å›ä¸€ä¸ªæ¥å—ç»„ä»¶ä½œä¸ºå‡½æ•°çš„å‡½æ•°` è¿™ç§ä¸œè¥¿ï¼Œå¦‚æœä½ æ˜¯æ–°ä¸Šæ‰‹ï¼ˆæˆ–è€…å“ªæ€•æ˜¯ React è€æ‰‹ï¼‰è¿™å¥—ä¸œè¥¿çš„äººï¼Œä½ ä¼šåœ¨ ã€Œè¿™ä¸ª props æ˜¯ä»å“ªä¸ª HOC é‡Œæ¥çš„ï¼Ÿã€ï¼Œã€Œè¿™ä¸ª props æ˜¯å¤–éƒ¨ä¼ å…¥çš„è¿˜æ˜¯ HOC é‡Œå¾—åˆ°çš„ï¼Ÿã€è¿™äº›é—®é¢˜ä¸­è¿·å¤±äº†å¤§è„‘ï¼Œæœ€ç»ˆèµ°å‘å •è½ï¼ˆè¯¯ï¼‰ã€‚

ä¸è°ˆ HOCï¼Œæˆ‘çš„è„‘å­å·²ç»å¿«ç‚¸å¼€æ¥äº†ï¼Œæ¥çœ‹çœ‹ç”¨ Hook çš„æ–¹å¼å¤ç”¨é€»è¾‘æ˜¯æ€ä¹ˆæ ·çš„åœºæ™¯å§ï¼Ÿ

```
function MenuBar(props) {
  // props é‡ŒåªåŒ…å«çˆ¶ç»„ä»¶ä¼ å…¥çš„å±æ€§
  const { show } = props;
  // èœå•
  const { onClickRemix, onClickNew } = useMenuBar();
  // å›½é™…åŒ–
  const { intl } = useIntl();
  // react-redux
  const { user } = useSelector((store) => store.user);
}

export default MenuBar;
å¤åˆ¶ä»£ç 
```

ä¸€åˆ‡éƒ½å˜å¾—å¾ˆæ˜æœ—ï¼Œæˆ‘å¯ä»¥éå¸¸æ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªæ–¹æ³•çš„æ¥æºï¼Œ`intl` æ˜¯å“ªé‡Œæ³¨å…¥è¿›æ¥çš„ï¼Œç‚¹å‡»äº† `useMenuBar` åï¼Œå°±è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”çš„é€»è¾‘ï¼Œç»´æŠ¤å’Œå¯è¯»æ€§éƒ½æå¤§çš„æé«˜äº†ã€‚

å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒã€Œåˆ»æ„ã€çš„ä¾‹å­ï¼Œä½†æ˜¯ç›¸ä¿¡æˆ‘ï¼Œæˆ‘åœ¨ React å¼€å‘ä¸­å·²ç»ä½“éªŒè¿‡è¿™ç§æ”¶ç›Šäº†ã€‚éšç€ç»„ä»¶çš„ã€ŒèŒè´£ã€è¶Šæ¥è¶Šå¤šï¼Œåªè¦ä½ æŒæ¡äº†è¿™ç§ä»£ç ç»„ç»‡çš„æ€è·¯ï¼Œé‚£ä¹ˆä½ çš„ç»„ä»¶å¹¶ä¸ä¼šè†¨èƒ€åˆ°ä¸å¯è¯»ã€‚

#### å¸¸è§çš„è¯·æ±‚åœºæ™¯

å†ä¸¾ä¸ªéå¸¸å¸¸è§çš„è¯·æ±‚åœºæ™¯ã€‚

åœ¨ Vue2 ä¸­å¦‚æœæˆ‘éœ€è¦è¯·æ±‚ä¸€ä»½æ•°æ®ï¼Œå¹¶ä¸”åœ¨`loading`å’Œ`error`æ—¶éƒ½å±•ç¤ºå¯¹åº”çš„è§†å›¾ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šè¿™æ ·å†™ï¼š

```
<template>
    <div v-if="error">failed to load</div>
    <div v-else-if="loading">loading...</div>
    <div v-else>hello {{fullName}}!</div>
</template>

<script>
import { createComponent, computed } from 'vue'

export default {
  data() {
    // é›†ä¸­å¼çš„dataå®šä¹‰ å¦‚æœæœ‰å…¶ä»–é€»è¾‘ç›¸å…³çš„æ•°æ®å°±å¾ˆå®¹æ˜“æ··ä¹±
    return {
        data: {
            firstName: '',
            lastName: ''
        },
        loading: false,
        error: false,
    },
  },
  async created() {
      try {
        // ç®¡ç†loading
        this.loading = true
        // å–æ•°æ®
        const data = await this.$axios('/api/user')
        this.data = data
      } catch (e) {
        // ç®¡ç†error
        this.error = true
      } finally {
        // ç®¡ç†loading
        this.loading = false
      }
  },
  computed() {
      // æ²¡äººçŸ¥é“è¿™ä¸ªfullNameå’Œå“ªä¸€éƒ¨åˆ†çš„å¼‚æ­¥è¯·æ±‚æœ‰å…³ å’Œå“ªä¸€éƒ¨åˆ†çš„dataæœ‰å…³ é™¤éä»”ç»†é˜…è¯»
      // åœ¨ç»„ä»¶å¤§äº†ä»¥åæ›´æ˜¯å¦‚æ­¤
      fullName() {
          return this.data.firstName + this.data.lastName
      }
  }
}
</script>
å¤åˆ¶ä»£ç 
```

è¿™æ®µä»£ç ï¼Œæ€ä¹ˆæ ·éƒ½è°ˆä¸ä¸Šä¼˜é›…ï¼Œå‡‘åˆçš„æŠŠåŠŸèƒ½å®Œæˆè€Œå·²ï¼Œå¹¶ä¸”å¯¹äº`loading`ã€`error`ç­‰å¤„ç†çš„å¯å¤ç”¨æ€§ä¸ºé›¶ã€‚

æ•°æ®å’Œé€»è¾‘ä¹Ÿè¢«åˆ†æ•£åœ¨äº†å„ä¸ª`option`ä¸­ï¼Œè¿™è¿˜åªæ˜¯ä¸€ä¸ªé€»è¾‘ï¼Œå¦‚æœåˆå¤šäº†ä¸€äº›é€»è¾‘ï¼Œå¤šäº†`data`ã€`computed`ã€`methods`ï¼Ÿå¦‚æœä½ æ˜¯ä¸€ä¸ªæ–°æ¥æ‰‹è¿™ä¸ªæ–‡ä»¶çš„äººï¼Œä½ å¦‚ä½•è¿…é€Ÿçš„åˆ†è¾¨æ¸…æ¥šè¿™ä¸ª`method`æ˜¯å’ŒæŸä¸¤ä¸ª`data`ä¸­çš„å­—æ®µå…³è”èµ·æ¥çš„ï¼Ÿ

è®©æˆ‘ä»¬æŠŠ[zeit/swr](https://github.com/zeit/swr)çš„é€»è¾‘ç…§æ¬åˆ° Vue3 ä¸­ï¼Œ

çœ‹ä¸€ä¸‹`swr`åœ¨ Vue3 ä¸­çš„è¡¨ç°ï¼š

```
<template>
    <div v-if="error">failed to load</div>
    <div v-else-if="loading">loading...</div>
    <div v-else>hello {{fullName}}!</div>
</template>

<script>
import { createComponent, computed } from 'vue'
import useSWR from 'vue-swr'

export default createComponent({
  setup() {
      // useSWRå¸®ä½ ç®¡ç†å¥½äº†å–æ•°ã€ç¼“å­˜ã€ç”šè‡³æ ‡ç­¾é¡µèšç„¦é‡æ–°è¯·æ±‚ã€ç”šè‡³Suspense...
      const { data, loading, error } = useSWR('/api/user', fetcher)
      // è½»æ¾çš„å®šä¹‰è®¡ç®—å±æ€§
      const fullName = computed(() => data.firstName + data.lastName)
      return { data, fullName, loading, error }
  }
})
</script>
å¤åˆ¶ä»£ç 
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå¯¹å—ï¼Ÿé€»è¾‘æ›´åŠ èšåˆäº†ã€‚

å¯¹äº†ï¼Œé¡ºå˜´ä¸€æï¼Œ `use-swr` çš„å¨åŠ›å¯è¿œè¿œä¸æ­¢çœ‹åˆ°çš„è¿™ä¹ˆç®€å•ï¼Œéšä¾¿ä¸¾å‡ ä¸ªå®ƒçš„èƒ½åŠ›ï¼š

1. é—´éš”è½®è¯¢
2. è¯·æ±‚é‡å¤æ•°æ®åˆ é™¤
3. å¯¹äºåŒä¸€ä¸ª key çš„æ•°æ®è¿›è¡Œç¼“å­˜
4. å¯¹æ•°æ®è¿›è¡Œä¹è§‚æ›´æ–°
5. åœ¨æ ‡ç­¾é¡µèšç„¦çš„æ—¶å€™é‡æ–°å‘èµ·è¯·æ±‚
6. åˆ†é¡µæ”¯æŒ
7. å®Œå¤‡çš„ TypeScript æ”¯æŒ

ç­‰ç­‰ç­‰ç­‰â€¦â€¦è€Œè¿™ä¹ˆå¤šå¦‚æ­¤å¼ºå¤§çš„èƒ½åŠ›ï¼Œéƒ½åœ¨ä¸€ä¸ªå°å°çš„ `useSWR()` å‡½æ•°ä¸­ï¼Œè°èƒ½è¯´è¿™ä¸æ˜¯é­”æ³•å‘¢ï¼Ÿ

ç±»ä¼¼çš„ä¾‹å­è¿˜æ•°ä¸èƒœæ•°ã€‚

[umi-hooks](https://link.zhihu.com/?target=http%3A//github.com/umijs/hooks)

[react-use](https://github.com/streamich/react-use)

### ä»£ç ç»„ç»‡

ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šï¼Œè¿˜åªæ˜¯è¯´äº† Hook çš„å…¶ä¸­ä¸€ä¸ªä¼˜åŠ¿ã€‚è¿™å…¶å®å¹¶ä¸èƒ½è§£å†³ã€Œæ„å¤§åˆ©é¢æ¡ä»£ç ã€çš„é—®é¢˜ã€‚å½“é€»è¾‘å¤šèµ·æ¥ä»¥åï¼Œç»„ä»¶çš„é€»è¾‘ä¼šç³…åˆåœ¨ä¸€èµ·å˜å¾—ä¸€å›¢ä¹±éº»å—ï¼Ÿ

#### ä»è·å–é¼ æ ‡ä½ç½®çš„éœ€æ±‚è®²èµ·

æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªè·¨ç»„ä»¶çš„éœ€æ±‚ï¼Œæˆ‘æƒ³åœ¨ç»„ä»¶é‡Œè·å¾—ä¸€ä¸ªå“åº”å¼çš„å˜é‡ï¼Œèƒ½å®æ—¶çš„æŒ‡å‘æˆ‘é¼ æ ‡æ‰€åœ¨çš„ä½ç½®ã€‚

Vue å®˜æ–¹ç»™å‡ºçš„è‡ªå®šä¹‰ Hook çš„ä¾‹å­æ˜¯è¿™æ ·çš„ï¼š

```
import { ref, onMounted, onUnmounted } from "vue";

export function useMousePosition() {
  const x = ref(0);
  const y = ref(0);

  function update(e) {
    x.value = e.pageX;
    y.value = e.pageY;
  }

  onMounted(() => {
    window.addEventListener("mousemove", update);
  });

  onUnmounted(() => {
    window.removeEventListener("mousemove", update);
  });

  return { x, y };
}
å¤åˆ¶ä»£ç 
```

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```
import { useMousePosition } from "./mouse";

export default {
  setup() {
    const { x, y } = useMousePosition();
    // other logic...
    return { x, y };
  },
};
å¤åˆ¶ä»£ç 
```

å°±è¿™ä¹ˆç®€å•ï¼Œæ— éœ€å¤šè¨€ã€‚åœ¨ä»»ä½•ç»„ä»¶ä¸­æˆ‘ä»¬éœ€è¦ã€Œè·å–å“åº”å¼çš„é¼ æ ‡ä½ç½®ã€ï¼Œå¹¶ä¸”å’Œæˆ‘ä»¬çš„ã€Œè§†å›¾å±‚ã€å…³è”èµ·æ¥çš„æ—¶å€™ï¼Œä»…ä»…éœ€è¦ç®€å•çš„ä¸€å¥è¯å³å¯ã€‚å¹¶ä¸”è¿™é‡Œè¿”å›çš„ `x`ã€`y` æ˜¯ç”± `ref` åŠ å·¥è¿‡çš„å“åº”å¼å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `watch` ç›‘å¬å®ƒä»¬ï¼Œå¯ä»¥æŠŠå®ƒä»¬ä¼ é€’ç»™å…¶ä»–çš„è‡ªå®šä¹‰ Hook ç»§ç»­ä½¿ç”¨ã€‚å‡ ä¹èƒ½åšåˆ°ä½ æƒ³è¦çš„ä¸€åˆ‡ï¼Œåªéœ€è¦å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ã€‚

#### ä» Vue å®˜æ–¹çš„ä¾‹å­è®²èµ·

ä¸Šé¢çš„ä¾‹å­è¶³å¤Ÿå…¥é—¨å’Œç²¾ç®€ï¼Œè®©æˆ‘ä»¬æ¥åˆ°ç°å®ä¸–ç•Œã€‚ä¸¾ä¸€ä¸ª [Vue CLI UI file explorer](https://github.com/vuejs/vue-cli/blob/a09407dd5b9f18ace7501ddb603b95e31d6d93c0/packages/@vue/cli-ui/src/components/folder/FolderExplorer.vue#L198-L404) å®˜æ–¹åæ§½çš„ä¾‹å­ï¼Œè¿™ä¸ªç»„ä»¶æ˜¯ Vue-CLI çš„ gui ä¸­ï¼ˆä¹Ÿå°±æ˜¯å¹³å¸¸æˆ‘ä»¬å‘½ä»¤è¡Œé‡Œè¾“å…¥ `vue ui` å‡ºæ¥çš„é‚£ä¸ªå›¾å½¢åŒ–æ§åˆ¶å°ï¼‰çš„ä¸€ä¸ªå¤æ‚çš„æ–‡ä»¶æµè§ˆå™¨ç»„ä»¶ï¼Œè¿™æ˜¯ Vue å®˜æ–¹å›¢é˜Ÿçš„å¤§ä½¬å†™çš„ï¼Œç›¸ä¿¡æ˜¯æ¯”è¾ƒæœ‰è¯´æœåŠ›çš„ä¸€ä¸ªæ¡ˆä¾‹äº†ã€‚

è¿™ä¸ªç»„ä»¶æœ‰ä»¥ä¸‹çš„å‡ ä¸ªåŠŸèƒ½ï¼š

1. è·Ÿè¸ªå½“å‰æ–‡ä»¶å¤¹çŠ¶æ€å¹¶æ˜¾ç¤ºå…¶å†…å®¹
2. å¤„ç†æ–‡ä»¶å¤¹å¯¼èˆªï¼ˆæ‰“å¼€ï¼Œå…³é—­ï¼Œåˆ·æ–°...ï¼‰
3. å¤„ç†æ–°æ–‡ä»¶å¤¹çš„åˆ›å»º
4. åˆ‡æ¢æ˜¾ç¤ºæ”¶è—å¤¹
5. åˆ‡æ¢æ˜¾ç¤ºéšè—æ–‡ä»¶å¤¹
6. å¤„ç†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹

æ–‡æ¡£ä¸­æå‡ºäº†ä¸€ä¸ªå°–é”çš„çµé­‚ä¹‹é—®ï¼Œä½ ä½œä¸ºä¸€ä¸ªæ–°æ¥æ‰‹çš„å¼€å‘äººå‘˜ï¼Œèƒ½å¤Ÿåœ¨èŒ«èŒ«çš„ `method`ã€`data`ã€`computed` ç­‰é€‰é¡¹ä¸­ä¸€ç›®äº†ç„¶çš„å‘ç°è¿™ä¸ªå˜é‡æ˜¯å±äºå“ªä¸ªåŠŸèƒ½å—ï¼Ÿæ¯”å¦‚ã€Œåˆ›å»ºæ–°æ–‡ä»¶å¤¹ã€åŠŸèƒ½ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®å±æ€§ï¼Œä¸€ä¸ªè®¡ç®—å±æ€§å’Œä¸€ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­è¯¥æ–¹æ³•åœ¨è·æ•°æ®å±æ€§ã€Œä¸€ç™¾è¡Œä»¥ä¸Šã€çš„ä½ç½®å®šä¹‰ã€‚

å½“ä¸€ä¸ªç»„ä»·ä¸­ï¼Œç»´æŠ¤åŒä¸€ä¸ªé€»è¾‘éœ€è¦è·¨è¶Šä¸Šç™¾è¡Œçš„ã€Œç©ºé—´è·ç¦»ã€çš„æ—¶å€™ï¼Œå³ä½¿æ˜¯è®©æˆ‘å»ç»´æŠ¤ Vue å®˜æ–¹å›¢é˜Ÿçš„ä»£ç ï¼Œæˆ‘ä¹Ÿä¼šæš—æ“æ“çš„åæ§½ä¸€å¥ï¼Œã€Œè¿™å†™çš„ä»€ä¹ˆç©æ„ï¼Œè¿™å˜é‡å¹²å˜›ç”¨çš„ï¼ã€

å°¤å¤§å¾ˆè´´å¿ƒçš„ç»™å‡ºäº†ä¸€å¼ å›¾ï¼Œåœ¨è¿™å¼ å›¾ä¸­ï¼Œä¸åŒçš„è‰²å—ä»£è¡¨ç€ä¸åŒçš„åŠŸèƒ½ç‚¹ã€‚



![img](https://user-gold-cdn.xitu.io/2020/4/20/17194f60261ac9e6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



å…¶å®å·²ç»åšçš„ä¸é”™äº†ï¼Œä½†æ˜¯åœ¨ç»´æŠ¤èµ·æ¥çš„æ—¶å€™è¿˜æ˜¯æŒºç¾éš¾çš„ï¼Œæ¯”å¦‚æ·¡è“è‰²çš„é‚£ä¸ªè‰²å—ä»£è¡¨çš„åŠŸèƒ½ã€‚æˆ‘æƒ³è¦å®Œæ•´çš„ç†æ¸…æ¥šå®ƒçš„é€»è¾‘ï¼Œéœ€è¦ã€Œä¸Šä¸‹åå¤æ¨ªè·³ã€ï¼Œç±»ä¼¼çš„äº‹æƒ…æˆ‘å·²ç»ç»å†è¿‡å¥½å¤šæ¬¡äº†ã€‚

è€Œä½¿ç”¨ Hook ä»¥åå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠã€Œæ–°å»ºæ–‡ä»¶å¤¹ã€è¿™ä¸ªåŠŸèƒ½ç¾ç¾çš„æŠ½åˆ°ä¸€ä¸ªå‡½æ•°ä¸­å»ï¼š

```
function useCreateFolder(openFolder) {
  // originally data properties
  const showNewFolder = ref(false);
  const newFolderName = ref("");

  // originally computed property
  const newFolderValid = computed(() => isValidMultiName(newFolderName.value));

  // originally a method
  async function createFolder() {
    if (!newFolderValid.value) return;
    const result = await mutate({
      mutation: FOLDER_CREATE,
      variables: {
        name: newFolderName.value,
      },
    });
    openFolder(result.data.folderCreate.path);
    newFolderName.value = "";
    showNewFolder.value = false;
  }

  return {
    showNewFolder,
    newFolderName,
    newFolderValid,
    createFolder,
  };
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬çº¦å®šè¿™äº›ã€Œè‡ªå®šä¹‰ Hookã€ä»¥ `use` ä½œä¸ºå‰ç¼€ï¼Œå’Œæ™®é€šçš„å‡½æ•°åŠ ä»¥åŒºåˆ†ã€‚

å³è¾¹ç”¨äº† Hook ä»¥åçš„ä»£ç ç»„ç»‡è‰²å—ï¼š



![img](https://user-gold-cdn.xitu.io/2020/4/20/17194f848bf2cf10?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



æˆ‘ä»¬æƒ³è¦ç»´æŠ¤ç´«è‰²éƒ¨åˆ†åŠŸèƒ½çš„é€»è¾‘ï¼Œé‚£å°±åœ¨ç´«è‰²çš„éƒ¨åˆ†å»æ‰¾å°±å¥½äº†ï¼Œåæ­£ä¸ä¼šæœ‰å…¶ä»–ã€Œè‰²å—ã€é‡Œçš„å˜é‡æˆ–è€…æ–¹æ³•å½±å“åˆ°å®ƒï¼Œå¾ˆå¿«å’±å°±æ”¹å¥½äº†éœ€æ±‚ï¼Œ6 ç‚¹å‡†æ—¶ä¸‹ç­ï¼

è¿™æ˜¯ Hook æ¨¡å¼ä¸‹çš„ç»„ä»¶æ¦‚è§ˆï¼ŒçœŸçš„æ˜¯ä¸€ç›®äº†ç„¶ã€‚æ„Ÿè§‰æˆ‘ä¹Ÿå¯ä»¥å»ç»´æŠ¤ `@vue/ui` äº†å‘¢ï¼ˆå‡çš„ï¼‰ã€‚

```
export default {
  setup() {
    // ...
  },
};

function useCurrentFolderData(networkState) {
  // ...
}

function useFolderNavigation({ networkState, currentFolderData }) {
  // ...
}

function useFavoriteFolder(currentFolderData) {
  // ...
}

function useHiddenFolders() {
  // ...
}

function useCreateFolder(openFolder) {
  // ...
}
å¤åˆ¶ä»£ç 
```

å†æ¥çœ‹çœ‹è¢«åæ§½æˆã€Œæ„å¤§åˆ©é¢æ¡ä»£ç ã€çš„ `setup` å‡½æ•°ã€‚

```
export default {
  setup() {
    // Network
    const { networkState } = useNetworkState();

    // Folder
    const { folders, currentFolderData } = useCurrentFolderData(networkState);
    const folderNavigation = useFolderNavigation({ networkState, currentFolderData });
    const { favoriteFolders, toggleFavorite } = useFavoriteFolders(currentFolderData);
    const { showHiddenFolders } = useHiddenFolders();
    const createFolder = useCreateFolder(folderNavigation.openFolder);

    // Current working directory
    resetCwdOnLeave();
    const { updateOnCwdChanged } = useCwdUtils();

    // Utils
    const { slicePath } = usePathUtils();

    return {
      networkState,
      folders,
      currentFolderData,
      folderNavigation,
      favoriteFolders,
      toggleFavorite,
      showHiddenFolders,
      createFolder,
      updateOnCwdChanged,
      slicePath,
    };
  },
};
å¤åˆ¶ä»£ç 
```

è¿™æ˜¯è°å®¶çš„å°ä»™å¥³è¿™ä¹ˆç¾å•Šï¼è¿™é€»è¾‘ä¹Ÿå¤ªæ¸…æ™°æ˜äº†ï¼Œå’Œæ„å¤§åˆ©é¢æ²¡åŠæ¯›é’±å…³ç³»å•Šï¼

## å¯¹æ¯”

### Hook å’Œ Mixin & HOC å¯¹æ¯”

è¯´åˆ°è¿™é‡Œï¼Œè¿˜æ˜¯ä¸å¾—ä¸æŠŠå®˜æ–¹å¯¹äºã€ŒMixin & HOC æ¨¡å¼ã€æ‰€å¸¦æ¥çš„ç¼ºç‚¹æ•´ç†ä¸€ä¸‹ã€‚

1. æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­å…¬å¼€çš„å±æ€§çš„æ¥æºä¸æ¸…æ¥šã€‚ ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨å¤šä¸ª mixin è¯»å–ç»„ä»¶çš„æ¨¡æ¿æ—¶ï¼Œå¯èƒ½å¾ˆéš¾ç¡®å®šä»å“ªä¸ª mixin æ³¨å…¥äº†ç‰¹å®šçš„å±æ€§ã€‚
2. å‘½åç©ºé—´å†²çªã€‚ Mixins å¯èƒ½ä¼šåœ¨å±æ€§å’Œæ–¹æ³•åç§°ä¸Šå‘ç”Ÿå†²çªï¼Œè€Œ HOC å¯èƒ½ä¼šåœ¨é¢„æœŸçš„ prop åç§°ä¸Šå‘ç”Ÿå†²çªã€‚
3. æ€§èƒ½é—®é¢˜ï¼ŒHOC å’Œæ— æ¸²æŸ“ç»„ä»¶éœ€è¦é¢å¤–çš„æœ‰çŠ¶æ€ç»„ä»¶å®ä¾‹ï¼Œè¿™ä¼šé™ä½æ€§èƒ½ã€‚

è€Œ ã€ŒHookã€æ¨¡å¼å¸¦æ¥çš„å¥½å¤„åˆ™æ˜¯ï¼š

1. æš´éœ²ç»™æ¨¡æ¿çš„å±æ€§å…·æœ‰æ˜ç¡®çš„æ¥æºï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä» Hook å‡½æ•°è¿”å›çš„å€¼ã€‚
2. Hook å‡½æ•°è¿”å›çš„å€¼å¯ä»¥ä»»æ„å‘½åï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿåç§°ç©ºé—´å†²çªã€‚
3. æ²¡æœ‰åˆ›å»ºä»…ç”¨äºé€»è¾‘é‡ç”¨çš„ä¸å¿…è¦çš„ç»„ä»¶å®ä¾‹ã€‚

å½“ç„¶ï¼Œè¿™ç§æ¨¡å¼ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ `ref` å¸¦æ¥çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œè¯¦è§[drawbacks](https://vue-composition-api-rfc.netlify.app/#drawbacks)ã€‚

### React Hook å’Œ Vue Hook å¯¹æ¯”

å…¶å® React Hook çš„é™åˆ¶éå¸¸å¤šï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­å°±ä¸“é—¨æœ‰ä¸€ä¸ª[ç« èŠ‚](https://zh-hans.reactjs.org/docs/hooks-rules.html)ä»‹ç»å®ƒçš„é™åˆ¶ï¼š

1. ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook
2. ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚
3. éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿ Hook åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®© React èƒ½å¤Ÿåœ¨å¤šæ¬¡çš„ useState å’Œ useEffect è°ƒç”¨ä¹‹é—´ä¿æŒ hook çŠ¶æ€çš„æ­£ç¡®ã€‚

è€Œ Vue å¸¦æ¥çš„ä¸åŒåœ¨äºï¼š

1. ä¸ React Hooks ç›¸åŒçº§åˆ«çš„é€»è¾‘ç»„åˆåŠŸèƒ½ï¼Œä½†æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚ ä¸ React Hook ä¸åŒï¼Œ`setup` å‡½æ•°ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè¿™åœ¨æ€§èƒ½ä¸Šæ¯”è¾ƒå ä¼˜ã€‚
2. å¯¹è°ƒç”¨é¡ºåºæ²¡ä»€ä¹ˆè¦æ±‚ï¼Œæ¯æ¬¡æ¸²æŸ“ä¸­ä¸ä¼šåå¤è°ƒç”¨ Hook å‡½æ•°ï¼Œäº§ç”Ÿçš„çš„ GC å‹åŠ›è¾ƒå°ã€‚
3. ä¸å¿…è€ƒè™‘å‡ ä¹æ€»æ˜¯éœ€è¦ useCallback çš„é—®é¢˜ï¼Œä»¥é˜²æ­¢ä¼ é€’`å‡½æ•°prop`ç»™å­ç»„ä»¶çš„å¼•ç”¨å˜åŒ–ï¼Œå¯¼è‡´æ— å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚
4. React Hook æœ‰è‡­åæ˜­è‘—çš„é—­åŒ…é™·é˜±é—®é¢˜ï¼ˆç”šè‡³æˆäº†ä¸€é“çƒ­é—¨é¢è¯•é¢˜ï¼Œomgï¼‰ï¼Œå¦‚æœç”¨æˆ·å¿˜è®°ä¼ é€’æ­£ç¡®çš„ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseEffect å’Œ useMemo å¯èƒ½ä¼šæ•è·è¿‡æ—¶çš„å˜é‡ï¼Œè¿™ä¸å—æ­¤é—®é¢˜çš„å½±å“ã€‚ Vue çš„è‡ªåŠ¨ä¾èµ–å…³ç³»è·Ÿè¸ªç¡®ä¿è§‚å¯Ÿè€…å’Œè®¡ç®—å€¼å§‹ç»ˆæ­£ç¡®æ— è¯¯ã€‚
5. ä¸å¾—ä¸æä¸€å¥ï¼ŒReact Hook é‡Œçš„ã€Œä¾èµ–ã€æ˜¯éœ€è¦ä½ å»æ‰‹åŠ¨å£°æ˜çš„ï¼Œè€Œä¸”å®˜æ–¹æä¾›äº†ä¸€ä¸ª eslint æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶è™½ç„¶å¤§éƒ¨åˆ†æ—¶å€™æŒºæœ‰ç”¨çš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¹Ÿç‰¹åˆ«çƒ¦äººï¼Œéœ€è¦ä½ æ‰‹åŠ¨åŠ ä¸€è¡Œä¸‘é™‹çš„æ³¨é‡Šå»å…³é—­å®ƒã€‚

æˆ‘ä»¬è®¤å¯ React Hooks çš„åˆ›é€ åŠ›ï¼Œè¿™ä¹Ÿæ˜¯ Vue-Composition-Api çš„ä¸»è¦çµæ„Ÿæ¥æºã€‚ä¸Šé¢æåˆ°çš„é—®é¢˜ç¡®å®å­˜åœ¨äº React Hook çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ° Vue çš„å“åº”å¼æ¨¡å‹æ°å¥½å®Œç¾çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚

é¡ºå˜´ä¸€é¢˜ï¼ŒReact Hook çš„å¿ƒæ™ºè´Ÿæ‹…æ˜¯çœŸçš„å¾ˆä¸¥é‡ï¼Œå¦‚æœå¯¹æ­¤æ„Ÿå…´è¶£çš„è¯ï¼Œè¯·å‚è€ƒï¼š

ä½¿ç”¨ react hooks å¸¦æ¥çš„æ”¶ç›ŠæŠµå¾—è¿‡ä½¿ç”¨å®ƒçš„æˆæœ¬å—? - æå…ƒç§‹çš„å›ç­” - çŸ¥ä¹ [www.zhihu.com/question/35â€¦](https://www.zhihu.com/question/350523308/answer/858145147)

å¹¶ä¸”æˆ‘è‡ªå·±åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¹Ÿé‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘æƒ³å¯¹ç»„ä»¶ç”¨ `memo` è¿›è¡Œä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ï¼Œé—­åŒ…çš„é—®é¢˜çˆ†ç‚¸å¼çš„æš´éœ²äº†å‡ºæ¥ã€‚æœ€åæˆ‘ç”¨ `useReducer` å¤§æ³•è§£å†³äº†å…¶ä¸­å¾ˆå¤šé—®é¢˜ï¼Œè®©æˆ‘ä¸å¾—ä¸æ€€ç–‘è¿™ä»å¤´åˆ°å°¾ä¼šä¸ä¼šå°±æ˜¯ `Dan` çš„é˜´è°‹â€¦â€¦ï¼ˆåˆ«æƒ³é€ƒè¿‡ `reducer`ï¼‰

[React Hook + TS è´­ç‰©è½¦å®æˆ˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ã€é—­åŒ…é™·é˜±ã€è‡ªå®šä¹‰ hookï¼‰](https://juejin.im/post/5e5a57b0f265da575b1bc055)

## åŸç†

æ—¢ç„¶æœ‰å¯¹æ¯”ï¼Œé‚£å°±ä»åŸç†çš„è§’åº¦æ¥è°ˆä¸€è°ˆä¸¤è€…çš„åŒºåˆ«ï¼Œ

åœ¨ Vue ä¸­ï¼Œä¹‹æ‰€ä»¥ `setup` å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼Œåç»­å¯¹äºæ•°æ®çš„æ›´æ–°ä¹Ÿå¯ä»¥é©±åŠ¨è§†å›¾æ›´æ–°ï¼Œå½’æ ¹ç»“åº•åœ¨äºå®ƒçš„ã€Œå“åº”å¼æœºåˆ¶ã€ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†è¿™æ ·ä¸€ä¸ªå“åº”å¼çš„å±æ€§ï¼š

### Vue

```
<template>
  <div>
    <span>{{count}}</span>
    <button @click="add"> +1 </button>
  </div>
</template>

export default {
    setup() {
        const count = ref(0)

        const add = () => count.value++

        return { count, add }
    }
}
å¤åˆ¶ä»£ç 
```

è¿™é‡Œè™½ç„¶åªæ‰§è¡Œäº†ä¸€æ¬¡ `setup` ä½†æ˜¯ `count` åœ¨åŸç†ä¸Šæ˜¯ä¸ª ã€Œå“åº”å¼å¯¹è±¡ã€ï¼Œå¯¹äºå…¶ä¸Š `value` å±æ€§çš„æ”¹åŠ¨ï¼Œ

æ˜¯ä¼šè§¦å‘ã€Œç”± template ç¼–è¯‘è€Œæˆçš„ render å‡½æ•°ã€ çš„é‡æ–°æ‰§è¡Œçš„ã€‚

å¦‚æœéœ€è¦åœ¨ `count` å‘ç”Ÿå˜åŒ–çš„æ—¶å€™åšæŸä»¶äº‹ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥ `effect` å‡½æ•°ï¼š

```
<template>
  <div>
    <span>{{count}}</span>
    <button @click="add"> +1 </button>
  </div>
</template>

export default {
    setup() {
        const count = ref(0)

        const add = () => count.value++

        effect(function log(){
            console.log('count changed!', count.value)
        })

        return { count, add }
    }
}
å¤åˆ¶ä»£ç 
```

è¿™ä¸ª `log` å‡½æ•°åªä¼šäº§ç”Ÿä¸€æ¬¡ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è¯»å– `count.value` çš„æ—¶å€™ä¼šæ”¶é›†å®ƒä½œä¸ºä¾èµ–ï¼Œé‚£ä¹ˆä¸‹æ¬¡ `count.value` æ›´æ–°åï¼Œè‡ªç„¶è€Œç„¶çš„å°±èƒ½è§¦å‘ `log` å‡½æ•°é‡æ–°æ‰§è¡Œäº†ã€‚

ä»”ç»†æ€è€ƒä¸€ä¸‹è¿™ä¹‹é—´çš„æ•°æ®å…³ç³»ï¼Œç›¸ä¿¡ä½ å¾ˆå¿«å°±å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆå®ƒå¯ä»¥åªæ‰§è¡Œä¸€æ¬¡ï¼Œä½†æ˜¯å´å¨åŠ›æ— ç©·ã€‚

å®é™…ä¸Š Vue3 çš„ Hook åªéœ€è¦ä¸€ä¸ªã€Œåˆå§‹åŒ–ã€çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ `setup`ï¼Œå‘½åå¾ˆå‡†ç¡®ã€‚å®ƒçš„å…³é”®å­—å°±æ˜¯ã€Œåªæ‰§è¡Œä¸€æ¬¡ã€ã€‚

### React

åŒæ ·çš„é€»è¾‘åœ¨ React ä¸­ï¼Œåˆ™æ˜¯è¿™æ ·çš„å†™æ³•ï¼š

```
export default function Counter() {
  const [count, setCount] = useState(0);

  const add = () => setCount((prev) => prev + 1);

  // ä¸‹æ–‡è®²è§£ç”¨
  const [count2, setCount2] = useState(0);

  return (
    <div>
      <span>{count}</span>
      <button onClick={add}> +1 </button>
    </div>
  );
}
å¤åˆ¶ä»£ç 
```

å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œçˆ¶ç»„ä»¶å¼•å…¥å®ƒæ˜¯é€šè¿‡ `` è¿™ç§æ–¹å¼å¼•å…¥çš„ï¼Œå®é™…ä¸Šå®ƒä¼šè¢«ç¼–è¯‘æˆ `React.createElement(Counter)` è¿™æ ·çš„å‡½æ•°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æ¸²æŸ“ï¼Œè¿™ä¸ªå‡½æ•°éƒ½ä¼šè¢«å®Œæ•´çš„æ‰§è¡Œä¸€æ¬¡ã€‚

è€Œ `useState` è¿”å›çš„ `count` å’Œ `setCount` åˆ™ä¼šè¢«ä¿å­˜åœ¨ç»„ä»¶å¯¹åº”çš„ `Fiber` èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ª React å‡½æ•°æ¯æ¬¡æ‰§è¡Œ Hook çš„é¡ºåºå¿…é¡»æ˜¯ç›¸åŒçš„ï¼Œä¸¾ä¾‹æ¥è¯´ã€‚ è¿™ä¸ªä¾‹å­é‡Œçš„ `useState` åœ¨åˆæ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œç”±äºæ‰§è¡Œäº†ä¸¤æ¬¡ `useState`ï¼Œä¼šåœ¨ `Fiber` ä¸Šä¿å­˜ä¸€ä¸ª `{ value, setValue } -> { value2, setValue2 }` è¿™æ ·çš„é“¾è¡¨ç»“æ„ã€‚

è€Œä¸‹ä¸€æ¬¡æ¸²æŸ“åˆä¼šæ‰§è¡Œ `count çš„ useState`ã€ `count2 çš„ useState`ï¼Œé‚£ä¹ˆ React å¦‚ä½•ä» `Fiber` èŠ‚ç‚¹ä¸Šæ‰¾å‡ºä¸Šæ¬¡æ¸²æŸ“ä¿ç•™ä¸‹æ¥çš„å€¼å‘¢ï¼Ÿå½“ç„¶æ˜¯åªèƒ½æŒ‰é¡ºåºæ‰¾å•¦ã€‚

ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„ useState å°±æ‹¿åˆ°ç¬¬ä¸€ä¸ª `{ value, setValue }`ï¼Œç¬¬äºŒä¸ªæ‰§è¡Œçš„å°±æ‹¿åˆ°ç¬¬äºŒä¸ª `{ value2, setValue2 }`ï¼Œ

è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ React ä¸¥æ ¼é™åˆ¶ Hook çš„æ‰§è¡Œé¡ºåºå’Œç¦æ­¢æ¡ä»¶è°ƒç”¨ã€‚

å‡å¦‚ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸¤æ¬¡ useStateï¼Œè€Œç¬¬äºŒæ¬¡æ¸²æŸ“æ—¶ç¬¬ä¸€ä¸ª useState è¢« if æ¡ä»¶åˆ¤æ–­ç»™å–æ¶ˆæ‰äº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ª `count2 çš„ useState` å°±ä¼šæ‹¿åˆ°é“¾è¡¨ä¸­ç¬¬ä¸€æ¡çš„å€¼ï¼Œå®Œå…¨æ··ä¹±äº†ã€‚

å¦‚æœåœ¨ React ä¸­ï¼Œè¦ç›‘å¬ `count` çš„å˜åŒ–åšæŸäº›äº‹çš„è¯ï¼Œä¼šç”¨åˆ° `useEffect` çš„è¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡ `render`

ä¹‹åä¼šæŠŠå‰åä¸¤æ¬¡ `render` ä¸­æ‹¿åˆ°çš„ `useEffect` çš„ç¬¬äºŒä¸ªå‚æ•° `deps` ä¾èµ–å€¼è¿›è¡Œä¸€ä¸ªé€é¡¹çš„æµ…å¯¹æ¯”ï¼ˆå¯¹å‰åæ¯ä¸€é¡¹ä¾æ¬¡è°ƒç”¨ Object.isï¼‰ï¼Œæ¯”å¦‚

```
export default function Counter() {
  const [count, setCount] = useState(0);

  const add = () => setCount((prev) => prev + 1);

  useEffect(() => {
    console.log("count updated!", count);
  }, [count]);

  return (
    <div>
      <span>{count}</span>
      <button onClick={add}> +1 </button>
    </div>
  );
}
å¤åˆ¶ä»£ç 
```

é‚£ä¹ˆï¼Œå½“ React åœ¨æ¸²æŸ“åå‘ç° `count` å‘ç”Ÿäº†å˜åŒ–ï¼Œä¼šæ‰§è¡Œ `useEffect` ä¸­çš„å›è°ƒå‡½æ•°ã€‚ï¼ˆç»†å¿ƒçš„ä½ å¯ä»¥è§‚å¯Ÿå‡ºæ¥ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°äº§ç”Ÿä¸€ä¸ªå‡½æ•°å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯ useEffect çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚

æ˜¯çš„ï¼ŒReact è¿˜æ˜¯ä¸å¯é¿å…çš„å¼•å…¥äº† `ä¾èµ–` è¿™ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯è¿™ä¸ª `ä¾èµ–` æ˜¯éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨ä¹¦å†™çš„ï¼Œå®æ—¶ä¸Š React ç¤¾åŒºæ‰€è®¨è®ºçš„ã€Œå¿ƒæ™ºè´Ÿæ‹…ã€ä¹ŸåŸºæœ¬ä¸Šæ˜¯ç”±äºè¿™ä¸ª `ä¾èµ–` æ‰€å¼•èµ·çš„â€¦â€¦

ç”±äºæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šä¸æ–­çš„æ‰§è¡Œå¹¶äº§ç”Ÿé—­åŒ…ï¼Œé‚£ä¹ˆä»æ€§èƒ½ä¸Šå’Œ GC å‹åŠ›ä¸Šéƒ½ä¼šç¨é€Šäº Vue3ã€‚å®ƒçš„å…³é”®å­—æ˜¯ã€Œæ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°æ‰§è¡Œã€ã€‚

## å…³äºæŠ„è¢­ React Hook

å…¶å®å‰ç«¯å¼€æºç•Œè°ˆæŠ„è¢­ä¹Ÿä¸å¤ªå¥½ï¼Œä¸€ç§æ–°çš„æ¨¡å¼çš„å‡ºç°çš„å€¼å¾—æ¡†æ¶ä¹‹é—´ç›¸äº’å€Ÿé‰´å’Œå­¦ä¹ çš„ï¼Œæ¯•ç«Ÿæ¡†æ¶å½’æ ¹ç»“åº•çš„ç›®çš„ä¸æ˜¯ä¸ºäº†ã€Œæ ‡æ¦œè‡ªå·±çš„ç‰¹ç«‹ç‹¬è¡Œã€ï¼Œè€Œæ˜¯ã€Œæ–¹ä¾¿å¹¿å¤§å¼€å‘è€…ã€ã€‚è¿™æ˜¯å€¼å¾—æ€è€ƒçš„ä¸€ç‚¹ï¼Œå¾ˆå¤šäººä¼¼ä¹è§‰å¾—ä¸€ä¸ªæ¡†æ¶ç”¨äº†æŸç§æ¨¡å¼ï¼Œå¦ä¸€ä¸ªæ¡†æ¶å°±ä¸èƒ½ç”¨ï¼Œå…¶å®è¿™å¯¹äºæ¡†æ¶ä¹‹é—´çš„è¿›æ­¥å’Œå‘å±•å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½å¤„ã€‚

è¿™é‡Œç›´æ¥å¼•ç”¨å°¤å¤§åœ¨ 17 å¹´[å›åº”](https://www.zhihu.com/people/evanyou/posts)ã€ŒVue å€Ÿé‰´è™šæ‹Ÿ domã€çš„ä¸€æ®µè¯å§ï¼š

> å†è¯´ vdomã€‚React çš„ vdom å…¶å®æ€§èƒ½ä¸æ€ä¹ˆæ ·ã€‚Vue 2.0 å¼•å…¥ vdom çš„ä¸»è¦åŸå› æ˜¯ vdom æŠŠæ¸²æŸ“è¿‡ç¨‹æŠ½è±¡åŒ–äº†ï¼Œä»è€Œä½¿å¾—ç»„ä»¶çš„æŠ½è±¡èƒ½åŠ›ä¹Ÿå¾—åˆ°æå‡ï¼Œå¹¶ä¸”å¯ä»¥é€‚é… DOM ä»¥å¤–çš„æ¸²æŸ“ç›®æ ‡ã€‚è¿™ä¸€ç‚¹æ˜¯å€Ÿé‰´ React æ¯«æ— äº‰è®®ï¼Œå› ä¸ºæˆ‘è®¤ä¸º vdom ç¡®å®æ˜¯ä¸ªå¥½æ€æƒ³ã€‚ä½†è¦åˆ†æ¸…æ¥šçš„æ˜¯ Vue å¼•å…¥ vdom ä¸æ˜¯å› ä¸ºã€react æœ‰æ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦æœ‰ã€ï¼Œè€Œæ˜¯å› ä¸ºå®ƒç¡®å®æœ‰æŠ€æœ¯ä¸Šçš„ä¼˜è¶Šæ€§ã€‚ç¤¾åŒºé‡ŒåŸºäº vdom æ€æƒ³é€ çš„è½®å­æµ·äº†å»äº†ï¼Œè€Œ ng2 çš„æ¸²æŸ“æŠ½è±¡å±‚å’Œ Ember Glimmer 2 çš„æ¨¡æ¿ -> opcode ç¼–è¯‘ä¹Ÿè·Ÿ vdom æœ‰å¾ˆå¤šæ€æƒ³ä¸Šçš„ç›¸ä¼¼æ€§ã€‚

è¿™æ®µè¯å¦‚ä»Šç”¨åˆ° Hook ä¸Šè¿˜æ˜¯ä¸€æ ·çš„é€‚ç”¨ï¼Œç¨‹åºå‘˜éƒ½æå€¡å¼€æºç²¾ç¥ï¼Œæ€ä¹ˆåˆ°äº† Vue å’Œ React ä¹‹é—´æœ‰äº›äººåˆå˜å¾—å°æ°”èµ·æ¥äº†å‘¢ï¼Ÿè¯´çš„éš¾å¬ç‚¹ï¼ŒVue ä¿æŒè‡ªå·±çš„ç‰¹ç«‹ç‹¬è¡Œï¼Œé‚£ä½ å‡å¦‚æ¢äº†ä¸€å®¶æ–°å…¬å¸è¦ä½ ç”¨ Vueï¼Œä½ ä¸æ˜¯åˆå¾—ä»å¤´å­¦ä¸€éå˜›ã€‚

æ›´ä½•å†µ React ç¤¾åŒºä¹Ÿä¸€æ ·æœ‰å¯¹ Vue çš„å€Ÿé‰´ï¼Œæ¯”å¦‚ä½ çœ‹ `react-router@6` çš„ apiï¼Œä½ ä¼šå‘ç°å¾ˆå¤šåœ°æ–¹å’Œ `vue-router` éå¸¸ç›¸ä¼¼äº†ã€‚æ¯”å¦‚ useRoutes çš„ã€Œé…ç½®å¼è·¯ç”±ã€ï¼Œä»¥åŠåœ¨ç»„ä»¶ä¸­ä½¿å­è·¯ç”±çš„ä»£ç ç»“æ„ç­‰ç­‰ã€‚å½“ç„¶è¿™åªæ˜¯æˆ‘æµ…æ˜¾çš„è®¤çŸ¥ï¼Œä¸å¯¹çš„åœ°æ–¹ä¹Ÿæ¬¢è¿æŒ‡æ­£ã€‚

## æ‰©å±•é˜…è¯»

å¯¹äºä¸¤ç§ Hook ä¹‹é—´çš„åŒºåˆ«ï¼Œæƒ³è¦è¿›ä¸€æ­¥å­¦ä¹ çš„åŒå­¦è¿˜å¯ä»¥çœ‹é»„å­æ¯…å¤§å¤§çš„å¥½æ–‡ï¼š

[ç²¾è¯»ã€ŠVue3.0 Function APIã€‹](https://juejin.im/post/5d1955e3e51d4556d86c7b09)

å°¤å°å³åœ¨å®˜æ–¹ issue ä¸­å¯¹äº React Hook è¯¦ç»†çš„å¯¹æ¯”çœ‹æ³•ï¼š

[Why remove time slicing from vue3?](https://github.com/vuejs/rfcs/issues/89)

## æ€»ç»“

å…¶å®æ€»ç»“ä¸‹æ¥ï¼Œç¤¾åŒºä¸­è¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†çš„åå¯¹è§‚ç‚¹æ˜¯ç”±äºã€Œæ²¡æœ‰å¥½å¥½çœ‹æ–‡æ¡£ã€é€ æˆçš„ï¼Œé‚£æœ¬æ–‡ä¸­æˆ‘å°±èŠ±è´¹è‡ªå·±ä¸€äº›ä¸šä½™æ—¶é—´æ•´ç†ç¤¾åŒºå’Œå®˜æ–¹çš„ä¸€äº›è§‚ç‚¹ä½œä¸ºä¸€ç¯‡æ–‡ç« ï¼Œè‡³äºçœ‹å®Œæ–‡ç« ä»¥åä½ ä¼šä¸ä¼šå¯¹ Vue3 çš„çœ‹æ³•æœ‰æ‰€æ”¹è§‚ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘èƒ½å†³å®šçš„ï¼Œåªä¸è¿‡æˆ‘å¾ˆå–œæ¬¢ Vue3ï¼Œæˆ‘ä¹Ÿå¸Œæœ›èƒ½å¤Ÿå°½è‡ªå·±çš„ä¸€ç‚¹åŠ›é‡ï¼Œè®©å¤§å®¶èƒ½å¤Ÿä¸è¦è¯¯è§£å®ƒã€‚

å¯¹äºæ„å¤§åˆ©é¢ä»£ç ï¼š

1. æå–å…±ç”¨çš„è‡ªå®šä¹‰ Hookï¼ˆåœ¨å†™ React è´­ç‰©è½¦ç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘æå–äº† 3 ä¸ªä»¥ä¸Šå¯ä»¥å…¨å±€å¤ç”¨çš„ Hookï¼‰ã€‚
2. åŸºäºã€Œé€»è¾‘åŠŸèƒ½ã€å»ç»„ç»‡ä»£ç ï¼Œè€Œä¸æ˜¯ `state` æ”¾åœ¨ä¸€å—ï¼Œ`method` æ”¾åœ¨ä¸€å—ï¼Œè¿™æ ·å’Œç”¨ Vue2 æ²¡ä»€ä¹ˆæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼ˆå¾ˆå¤šå¾ˆå¤šæ–°äººåœ¨ç”¨ React Hook çš„æ—¶å€™çŠ¯è¿™æ ·çš„é”™è¯¯ï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ï¼‰ã€‚

å¯¹äºå¿ƒæ™ºè´Ÿæ‹…ï¼š

1. æ›´å¼ºå¤§çš„èƒ½åŠ›æ„å‘³ç€æ›´å¤šçš„å­¦ä¹ æˆæœ¬ï¼Œä½†æ˜¯ Vue3 æ€»ä½“è€Œè¨€æˆ‘è§‰å¾—å·²ç»æŠŠå¿ƒæ™ºè´Ÿæ‹…æ§åˆ¶çš„å¾ˆåˆ°ä½äº†ã€‚å¯¹äº `ref` è¿™ä¸ªç©æ„ï¼Œç¡®å®æ˜¯éœ€è¦ä»”ç»†æ€è€ƒä¸€ä¸‹æ‰èƒ½ç†è§£ã€‚
2. React Hook çš„å¿ƒæ™ºè´Ÿæ‹…å·²ç»é‡çš„å‡ºåäº†ï¼Œåœ¨æˆ‘å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™çœŸçš„ä¼šè¢«æ•´åˆ°å¤´ç§ƒâ€¦â€¦ å°¤å…¶æ˜¯æŠ½äº†ä¸€äº›è‡ªå®šä¹‰ Hookï¼Œ`deps` ä¾èµ–ä¼šå±‚å±‚ä¼ é€’çš„æƒ…å†µä¸‹ï¼ˆéšä¾¿å“ªä¸€å±‚çš„ä¾èµ–é”™äº†ï¼Œä½ çš„åº”ç”¨å°±çˆ†ç‚¸äº†ï¼‰ã€‚
3. ä¸å­¦ä¹ æ€ä¹ˆèƒ½å‡èŒåŠ è–ªï¼Œè¿å¨¶ç™½å¯Œç¾ï¼Œèµ°å‘äººç”Ÿå·…å³°å‘¢ï¼ï¼ˆçæ‰¯ï¼‰

Vue3 æœ‰å¤šé¦™å‘¢ï¼Ÿç”šè‡³ã€ŠReact çŠ¶æ€ç®¡ç†ä¸åŒæ„å®æˆ˜ã€‹çš„ä½œè€…ã€React çš„å¿ å®ç²‰ä¸[Lucas HC](https://www.zhihu.com/people/lucas-hc)åœ¨è¿™ç¯‡ [Vue å’Œ React çš„ä¼˜ç‚¹åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ](https://www.zhihu.com/question/301860721/answer/724759264) ä¸­éƒ½è¯´äº†è¿™æ ·çš„ä¸€å¥è¯ï¼š

> æˆ‘ä¸åæ§½æ›´å¤šäº†ï¼šä¸€ä¸ª React ç²‰ä¸å‘ Vue3.0 è‡´æ•¬ï¼

Vue3 ç›®å‰ä¹Ÿå·²ç»æœ‰äº† Hook çš„ä¸€äº›å°è¯•ï¼š

[github.com/u3u/vue-hooâ€¦](https://github.com/u3u/vue-hooks)

æ€»ä¹‹ï¼Œå¸Œæœ›çœ‹å®Œè¿™ç¯‡æ–‡ç« çš„ä½ ï¼Œèƒ½å¤Ÿæ›´åŠ å–œæ¬¢ Vue3ï¼Œå¯¹äºå®ƒçš„åˆ°æ¥æˆ‘å·²ç»æ˜¯æœŸå¾…çš„ä¸è¡Œäº†ã€‚

æœ€åå†æ¬¡å¼ºè°ƒä¸€ä¸‹ä½œè€…çš„ç«‹åœºï¼Œæˆ‘å¯¹äº React å’Œ Vue éƒ½éå¸¸çš„å–œæ¬¢ã€‚ä»–ä»¬éƒ½æœ‰ç€å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œæœ¬æ–‡ç»æ— å¼•æˆ˜ä¹‹æ„ã€‚ä¸¤ä¸ªæ¡†æ¶éƒ½å¾ˆæ£’ï¼åªæ˜¯å„æœ‰ä¼˜ç¼ºç‚¹è€Œå·²ã€‚React çš„ Immutable å…¶å®ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šç›Šå¤„ï¼Œå¹¶ä¸” Hook çš„æ€è·¯è¿˜æ˜¯ Facebook å›¢é˜Ÿçš„å¤§ä½¬ä»¬é¦–åˆ›çš„ï¼ŒçœŸçš„æ˜¯å¾ˆè®©äººèµå¹çš„è®¾è®¡ï¼Œæˆ‘å¯¹ React 100% è‡´æ•¬ï¼

æœ¬æ–‡çš„å”¯ä¸€ç›®çš„å°±æ˜¯æƒ³æ¶ˆé™¤ä¸€äº›æœ‹å‹å¯¹äº Vue 3.0 çš„è¯¯è§£ï¼Œç»æ— ä»–æ„ï¼Œå¦‚æœ‰å†’çŠ¯æ•¬è¯·è°…è§£~