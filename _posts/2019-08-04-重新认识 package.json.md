---
layout: post
title: "é‡æ–°è®¤è¯† package.json"
date: 2019-08-04 
tags: package
---

#  é‡æ–°è®¤è¯† package.json

## å‰è¨€ ğŸ¤”

- åœ¨æ¯ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ª `package.json` æ–‡ä»¶ï¼Œå…¶å®šä¹‰äº†è¿è¡Œé¡¹ç›®æ‰€éœ€è¦çš„å„ç§ä¾èµ–å’Œé¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼ˆå¦‚åç§°ã€ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰å…ƒæ•°æ®ï¼‰ã€‚

  å¤§å¤šæ•°äººå¯¹ `package.json` æ–‡ä»¶çš„äº†è§£ï¼Œä»…åœç•™åœ¨ï¼š

  - é¡¹ç›®åç§°ã€é¡¹ç›®æ„å»ºç‰ˆæœ¬ã€è®¸å¯è¯çš„å®šä¹‰ï¼›
  - ä¾èµ–å®šä¹‰ï¼ˆåŒ…æ‹¬ `dependencies` å­—æ®µï¼Œ`devDependencies` å­—æ®µï¼‰ï¼›
  - ä½¿ç”¨`scripts`å­—æ®µæŒ‡å®šè¿è¡Œè„šæœ¬å‘½ä»¤çš„ `npm` å‘½ä»¤è¡Œç¼©å†™ã€‚

  å…¶å®ï¼Œ`package.json` çš„ä½œç”¨è¿œä¸æ­¢äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°å¢é…ç½®é¡¹å®ç°æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¸‹é¢å°†å¸¦ä½ é‡æ–°è®¤è¯†  `package.json`ã€‚

## ç”±ç®€å…¥ç¹ï¼Œä¸°å¯Œé¡¹ç›®çš„ package.json

### ç®€å•ç‰ˆçš„ package.json

- å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªåç§°ä¸º `my-test` çš„é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ `yarn init -y` æˆ– `npm init -y` å‘½ä»¤åï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹ä¼šæ–°å¢ä¸€ä¸ª `package.json`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
{
  "name": "my-test", # é¡¹ç›®åç§°
  "version": "1.0.0", # é¡¹ç›®ç‰ˆæœ¬ï¼ˆæ ¼å¼ï¼šå¤§ç‰ˆæœ¬.æ¬¡è¦ç‰ˆæœ¬.å°ç‰ˆæœ¬ï¼‰
  "description": "", # é¡¹ç›®æè¿°
  "main": "index.js", # å…¥å£æ–‡ä»¶
  "scripts": { # æŒ‡å®šè¿è¡Œè„šæœ¬å‘½ä»¤çš„ npm å‘½ä»¤è¡Œç¼©å†™
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [], # å…³é”®è¯
  "author": "", # ä½œè€…
  "license": "ISC" # è®¸å¯è¯
}
å¤åˆ¶ä»£ç 
```

- å¯ä»¥çœ‹åˆ°ï¼Œ`package.json` æ–‡ä»¶çš„å†…å®¹æ˜¯ä¸€ä¸ª `JSON` å¯¹è±¡ï¼Œå¯¹è±¡çš„æ¯ä¸€ä¸ªæˆå‘˜å°±æ˜¯å½“å‰é¡¹ç›®çš„ä¸€é¡¹é…ç½®ã€‚

### å®‰è£…é¡¹ç›®ä¾èµ–ï¼ˆdependencies & devDependenciesï¼‰

##### `dependencies`å­—æ®µæŒ‡å®šäº†é¡¹ç›®è¿è¡Œæ‰€ä¾èµ–çš„æ¨¡å—ï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰ï¼Œå¦‚ `antd`ã€ `react`ã€ `moment`ç­‰æ’ä»¶åº“ï¼š

- å®ƒä»¬æ˜¯æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒæ‰€éœ€è¦çš„ä¾èµ–é¡¹ï¼Œåœ¨æŠŠé¡¹ç›®ä½œä¸ºä¸€ä¸ª `npm` åŒ…çš„æ—¶å€™ï¼Œç”¨æˆ·å®‰è£… `npm` åŒ…æ—¶åªä¼šå®‰è£… `dependencies` é‡Œé¢çš„ä¾èµ–ã€‚

`devDependencies` å­—æ®µæŒ‡å®šäº†é¡¹ç›®å¼€å‘æ‰€éœ€è¦çš„æ¨¡å—ï¼ˆå¼€å‘ç¯å¢ƒä½¿ç”¨ï¼‰ï¼Œå¦‚ `webpack`ã€`typescript`ã€`babel`ç­‰ï¼š

- åœ¨ä»£ç æ‰“åŒ…æäº¤çº¿ä¸Šæ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™äº›å·¥å…·ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒæ”¾å…¥ `devDependencies` ä¸­ã€‚

å¦‚æœä¸€ä¸ªæ¨¡å—ä¸åœ¨ `package.json` æ–‡ä»¶ä¹‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬å®‰è£…è¿™ä¸ªæ¨¡å—ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„å‚æ•°ï¼Œå°†å…¶å†™å…¥ `dependencies` å­—æ®µ/ `devDependencies` å­—æ®µä¸­ï¼š



- - åœ¨ä»£ç æ‰“åŒ…æäº¤çº¿ä¸Šæ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™äº›å·¥å…·ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒæ”¾å…¥ `devDependencies` ä¸­ã€‚
- å¦‚æœä¸€ä¸ªæ¨¡å—ä¸åœ¨ `package.json` æ–‡ä»¶ä¹‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬å®‰è£…è¿™ä¸ªæ¨¡å—ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„å‚æ•°ï¼Œå°†å…¶å†™å…¥ `dependencies` å­—æ®µ/ `devDependencies` å­—æ®µä¸­ï¼š

```
# ä½¿ç”¨ npm
npm install <package...> --save # å†™å…¥ dependencies å±æ€§
npm install <package...> --save-dev # å†™å…¥ devDependencies å±æ€§

# ä½¿ç”¨ yarn
yarn add <package...> # å†™å…¥ dependencies å±æ€§
yarn add <package...> --dev # å†™å…¥ devDependencies å±æ€§
å¤åˆ¶ä»£ç 
```

- æœ‰äº† `package.json` æ–‡ä»¶ï¼Œå¼€å‘ç›´æ¥ä½¿ç”¨ `npm install` / `yarn install` å‘½ä»¤ï¼Œå°±ä¼šåœ¨å½“å‰ç›®å½•ä¸­è‡ªåŠ¨å®‰è£…æ‰€éœ€è¦çš„æ¨¡å—ï¼Œå®‰è£…å®Œæˆé¡¹ç›®æ‰€éœ€çš„è¿è¡Œå’Œå¼€å‘ç¯å¢ƒå°±é…ç½®å¥½äº†ã€‚

### ç®€åŒ–ç»ˆç«¯å‘½ä»¤ï¼ˆscriptsï¼‰

- `scripts` å­—æ®µæ˜¯ `package.json` ä¸­çš„ä¸€ç§å…ƒæ•°æ®åŠŸèƒ½ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§ä¸ºå¯ä»¥é€šè¿‡ `npm run `è¿è¡Œçš„è„šæœ¬ï¼Œå€¼ä¸ºå®é™…è¿è¡Œçš„å‘½ä»¤ï¼ˆé€šå¸¸æ˜¯ç»ˆç«¯å‘½ä»¤ï¼‰ï¼Œå¦‚ï¼š

```
"scripts": {
  "start": "node index.js"
},
å¤åˆ¶ä»£ç 
```

- å°†ç»ˆç«¯å‘½ä»¤æ”¾å…¥ `scripts` å­—æ®µï¼Œæ—¢å¯ä»¥è®°å½•å®ƒä»¬åˆå¯ä»¥å®ç°è½»æ¾é‡ç”¨ã€‚

### å®šä¹‰é¡¹ç›®å…¥å£ï¼ˆmainï¼‰

- `main` å­—æ®µæ˜¯ `package.json` ä¸­çš„å¦ä¸€ç§å…ƒæ•°æ®åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŒ‡å®šåŠ è½½çš„å…¥å£æ–‡ä»¶ã€‚å‡å¦‚ä½ çš„é¡¹ç›®æ˜¯ä¸€ä¸ª `npm` åŒ…ï¼Œå½“ç”¨æˆ·å®‰è£…ä½ çš„åŒ…åï¼Œ`require('my-module')` è¿”å›çš„æ˜¯ `main` å­—æ®µä¸­æ‰€åˆ—å‡ºæ–‡ä»¶çš„ `module.exports` å±æ€§ã€‚
- å½“ä¸æŒ‡å®š`main` å­—æ®µæ—¶ï¼Œé»˜è®¤å€¼æ˜¯æ¨¡å—æ ¹ç›®å½•ä¸‹é¢çš„`index.js` æ–‡ä»¶ã€‚

### æŒ‡å®šé¡¹ç›® node ç‰ˆæœ¬ï¼ˆenginesï¼‰

- æœ‰æ—¶å€™ï¼Œæ–°æ‹‰ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œç”±äºå’Œå…¶ä»–å¼€å‘ä½¿ç”¨çš„

   

  ```
  node
  ```

   

  ç‰ˆæœ¬ä¸åŒï¼Œå¯¼è‡´ä¼šå‡ºç°å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼ˆå¦‚æŸäº›ä¾èµ–å®‰è£…æŠ¥é”™ã€ä¾èµ–å®‰è£…å®Œé¡¹ç›®è·‘æ­¥èµ·æ¥ç­‰ï¼‰ã€‚

  ![img](https://user-gold-cdn.xitu.io/2020/5/14/1721282a38c1d9cd?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- ä¸ºäº†å®ç°é¡¹ç›®å¼€ç®±å³ç”¨çš„ä¼Ÿå¤§ç†æƒ³ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ `package.json` çš„ `engines` å­—æ®µæ¥æŒ‡å®šé¡¹ç›® node ç‰ˆæœ¬ï¼š

```
"engines": {
   "node": ">= 8.16.0"
},
å¤åˆ¶ä»£ç 
```

- è¯¥å­—æ®µä¹Ÿå¯ä»¥æŒ‡å®šé€‚ç”¨çš„ `npm` ç‰ˆæœ¬ï¼š

```
"engines": {
   "npm": ">= 6.9.0"
 },
å¤åˆ¶ä»£ç 
```

- éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œengineså±æ€§ä»…èµ·åˆ°ä¸€ä¸ªè¯´æ˜çš„ä½œç”¨ï¼Œå½“ç”¨æˆ·ç‰ˆæœ¬ä¸ç¬¦åˆæŒ‡å®šå€¼æ—¶ä¹Ÿä¸å½±å“ä¾èµ–çš„å®‰è£…ã€‚

### è‡ªå®šä¹‰å‘½ä»¤ï¼ˆbinï¼‰

- ç”¨è¿‡ `vue-cli`ï¼Œ`create-react-app`ç­‰è„šæ‰‹æ¶çš„æœ‹å‹ä»¬ï¼Œä¸çŸ¥é“ä½ ä»¬æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ï¼Œä¸ºä»€ä¹ˆå®‰è£…è¿™äº›è„šæ‰‹æ¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ç±»ä¼¼ `vue create`/`create-react-app`ä¹‹ç±»çš„å‘½ä»¤ï¼Œå…¶å®è¿™å’Œ `package.json` ä¸­çš„ `bin` å­—æ®µæœ‰å…³ã€‚

- `bin` å­—æ®µç”¨æ¥æŒ‡å®šå„ä¸ªå†…éƒ¨å‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ã€‚å½“`package.json` æä¾›äº† `bin` å­—æ®µåï¼Œå³ç›¸å½“äºåšäº†ä¸€ä¸ªå‘½ä»¤åå’Œæœ¬åœ°æ–‡ä»¶åçš„æ˜ å°„ã€‚

- å½“ç”¨æˆ·å®‰è£…å¸¦æœ‰

   

  ```
  bin
  ```

   

  å­—æ®µçš„åŒ…æ—¶ï¼Œ

  - å¦‚æœæ˜¯å…¨å±€å®‰è£…ï¼Œ`npm` å°†ä¼šä½¿ç”¨ç¬¦å·é“¾æ¥æŠŠè¿™äº›æ–‡ä»¶é“¾æ¥åˆ°`/usr/local/node_modules/.bin/`ï¼›
  - å¦‚æœæ˜¯æœ¬åœ°å®‰è£…ï¼Œä¼šé“¾æ¥åˆ°`./node_modules/.bin/`ã€‚

- ä¸¾ä¸ª ğŸŒ°ï¼Œå¦‚æœè¦ä½¿ç”¨ `my-app-cli` ä½œä¸ºå‘½ä»¤æ—¶ï¼Œå¯ä»¥é…ç½®ä»¥ä¸‹ `bin` å­—æ®µï¼š

```
"bin": {
  "my-app-cli": "./bin/cli.js"
}
å¤åˆ¶ä»£ç 
```

- ä¸Šé¢ä»£ç æŒ‡å®šï¼Œ`my-app-cli` å‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸º `bin` å­ç›®å½•ä¸‹çš„ `cli.js`ï¼Œå› æ­¤åœ¨å®‰è£…äº† `my-app-cli` åŒ…çš„é¡¹ç›®ä¸­ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ©ç”¨ `npm`æ‰§è¡Œè„šæœ¬ï¼š

```
"scripts": {
  start: 'node node_modules/.bin/my-app-cli'
}
å¤åˆ¶ä»£ç 
```



![img](https://user-gold-cdn.xitu.io/2020/5/14/1721272af3b9cccf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



- å’¦ï¼Œæ€ä¹ˆçœ‹èµ·æ¥å’Œ

   

  ```
  vue create
  ```

  /

  ```
  create-react-app
  ```

  ä¹‹ç±»çš„å‘½ä»¤ä¸å¤ªåƒï¼ŸåŸå› ï¼š

  - å½“éœ€è¦ `node` ç¯å¢ƒæ—¶å°±éœ€è¦åŠ ä¸Š `node` å‰ç¼€
  - å¦‚æœåŠ ä¸Š `node` å‰ç¼€ï¼Œå°±éœ€è¦æŒ‡å®š `my-app-cli` çš„è·¯å¾„ -> `node_modules/.bin`ï¼Œå¦åˆ™ `node my-app-cli`ä¼šå»æŸ¥æ‰¾å½“å‰è·¯å¾„ä¸‹çš„ `my-app-cli.js`ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸å¯¹ã€‚

- è‹¥è¦å®ç°åƒ `vue create`/`create-react-app`ä¹‹ç±»çš„å‘½ä»¤ä¸€æ ·ç®€ä¾¿çš„æ–¹å¼ï¼Œåˆ™å¯ä»¥åœ¨ä¸Šæ–‡æåˆ°çš„ `bin` å­ç›®å½•ä¸‹å¯æ‰§è¡Œæ–‡ä»¶`cli.js` ä¸­çš„ç¬¬ä¸€è¡Œå†™å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```
#!/usr/bin/env node
å¤åˆ¶ä»£ç 
```

- è¿™è¡Œå‘½ä»¤çš„ä½œç”¨æ˜¯å‘Šè¯‰ç³»ç»Ÿç”¨ `node` è§£æï¼Œè¿™æ ·å‘½ä»¤å°±å¯ä»¥ç®€å†™æˆ `my-app-cli` äº†ã€‚

### React é¡¹ç›®ç›¸å…³

#### è®¾ç½®åº”ç”¨æ ¹è·¯å¾„ï¼ˆhomepageï¼‰

- å½“æˆ‘ä»¬ä½¿ç”¨

   

  ```
  create-react-app
  ```

   

  è„šæ‰‹æ¶æ­å»ºçš„

   

  ```
  React
  ```

   

  é¡¹ç›®ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨å†…ç½®çš„

   

  ```
  webpack
  ```

   

  é…ç½®ï¼Œå½“

  ```
  package.json
  ```

   

  ä¸­ä¸é…ç½®

   

  ```
  homepage
  ```

   

  å±æ€§æ—¶ï¼Œbuild æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶èµ„æºåº”ç”¨è·¯å¾„é»˜è®¤æ˜¯

   

  ```
  /
  ```

  ï¼Œå¦‚ä¸‹å›¾ï¼š

  ![img](https://user-gold-cdn.xitu.io/2020/5/14/17212d519e0d2bd6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ‰“åŒ…çš„é™æ€èµ„æºä¼šéƒ¨ç½²åœ¨ `CDN` ä¸Šï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨çŸ¥é“å»å“ªé‡ŒåŠ è½½èµ„æºï¼Œåˆ™éœ€è¦æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ ¹è·¯å¾„ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡ `package.json` ä¸­çš„ `homepage` å­—æ®µè®¾ç½®åº”ç”¨çš„æ ¹è·¯å¾„ã€‚

- å½“æˆ‘ä»¬è®¾ç½®äº† `homepage` å±æ€§åï¼š

```
{
  "homepage": "https://xxxx.cdn/my-project",
}
å¤åˆ¶ä»£ç 
```

- æ‰“åŒ…åçš„èµ„æºè·¯å¾„å°±ä¼šåŠ ä¸Š

   

  ```
  homepage
  ```

   

  çš„åœ°å€ï¼š

  ![img](https://user-gold-cdn.xitu.io/2020/5/14/17212d9d11f9fdb0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

#### å¼€å‘ç¯å¢ƒè§£å†³è·¨åŸŸé—®é¢˜ï¼ˆproxyï¼‰

- åœ¨åšå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®çš„æ—¶å€™ï¼Œè°ƒç”¨æ¥å£æ—¶åˆ™ä¼šé‡åˆ°è·¨åŸŸçš„é—®é¢˜ï¼Œå½“åœ¨å¼€å‘ç¯å¢ƒä¸­æ—¶ï¼Œå¯ä»¥é€šè¿‡é…ç½® `package.json` ä¸­çš„ `proxy` æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œé…ç½®å¦‚ä¸‹ï¼š

```
{
  "proxy": "http://localhost:4000"  // é…ç½®ä½ è¦è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€
}
å¤åˆ¶ä»£ç 
```

- æ³¨æ„ï¼Œå½“ `create-react-app` çš„ç‰ˆæœ¬é«˜äº 2.0 ç‰ˆæœ¬çš„æ—¶å€™åœ¨ `package.json` ä¸­åªèƒ½é…ç½® `string` ç±»å‹ï¼Œè¿™æ„å‘³ç€å¦‚æœè¦ä½¿ç”¨ `package.json` æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œåˆ™åªèƒ½ä»£ç†ä¸€ä¸ªæœåŠ¡å™¨åœ°å€ã€‚
- å¦‚æœè¦ä»£ç†å¤šä¸ªæœåŠ¡å™¨åœ°å€æ—¶ï¼Œåˆ™éœ€è¦å®‰è£… `http-proxy-middleware` ï¼Œåœ¨ `src` ç›®å½•ä¸‹æ–°å»º `setupProxy.js` ï¼š

```
const proxy = require("http-proxy-middleware");
 
module.exports = function(app) {
  app.use(
    proxy("/base", {
      target: "http://localhost:4000",
      changeOrigin: true
    })
  );
  app.use(
    proxy("/fans", {
      target: "http://localhost:5000",
      changeOrigin: true
    })
  );
};
å¤åˆ¶ä»£ç 
```

#### æ ¹æ®å¼€å‘ç¯å¢ƒé‡‡ç”¨ä¸åŒçš„å…¨å±€å˜é‡å€¼ï¼ˆè‡ªå®šä¹‰å­—æ®µï¼‰

- å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªç»„ä»¶ï¼Œå½“ç»„ä»¶è¢«ç‚¹å‡»æ—¶ï¼Œåœ¨å¼€å‘ç¯å¢ƒæ—¶æ˜¯è·³è½¬æµ‹è¯•ç¯å¢ƒçš„ `sentry` åœ°å€ï¼Œåœ¨æ­£å¼ç¯å¢ƒæ—¶åˆ™è·³è½¬æ­£å¼ç¯å¢ƒçš„ `sentry` åœ°å€ã€‚
- é¦–å…ˆï¼Œé€šè¿‡é…ç½®å‰é¢æåˆ°çš„ `scripts` å­—æ®µï¼Œå®ç°ç¯å¢ƒå˜é‡ï¼ˆNODE_ENVï¼‰çš„è®¾ç½®ï¼š

```
"scripts": {
  "start": "NODE_ENV=development node scripts/start.js",
  "build": "NODE_ENV=production node scripts/build.js",
},
å¤åˆ¶ä»£ç 
```

- é¡¹ç›®å¯åŠ¨èµ·æ¥åï¼Œåœ¨ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ `process.env.NODE_ENV` è®¿é—®åˆ° `NODE_ENV` çš„å€¼ã€‚

##### æ–¹æ¡ˆä¸€

- æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­å†™ç±»ä¼¼ä»¥ä¸‹çš„åˆ¤æ–­ä»£ç ï¼Œæ ¹æ®ä¸åŒç¯å¢ƒç»™ `sentryUrl` è®¾ç½®ä¸åŒçš„å€¼ï¼š

```
let sentryUrl;
if (process.env.NODE_ENV === 'development') {
    sentryUrl = 'test-sentry.xxx.com';
} else {
    sentryUrl = 'sentry.xxx.com';
}
å¤åˆ¶ä»£ç 
```

- è¿™ä¹ˆåšå¥½åƒæ²¡æ¯›ç—…ï¼Œä½†æ˜¯æ·±å…¥ä¸€æƒ³ï¼Œå¦‚æœæœ‰å¤šä¸ªç»„ä»¶ï¼Œè¦æ ¹æ®ä¸åŒçš„ç¯å¢ƒä½¿ç”¨ä¸åŒçš„æœåŠ¡ï¼ˆå¤šç§æœåŠ¡ï¼‰åœ°å€ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢çš„å†™æ³•ï¼Œé¡¹ç›®ä¸­å°†å­˜åœ¨è®¸å¤šé‡å¤çš„åˆ¤æ–­ä»£ç ï¼Œä¸”å½“æœåŠ¡åœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŒ…å«è¿™äº›æœåŠ¡åœ°å€çš„ç»„ä»¶éƒ½éœ€è¦ç›¸åº”çš„åšæ”¹åŠ¨ï¼Œè¿™æ ·æ˜æ˜¾æ˜¯ä¸åˆç†çš„ã€‚

  ![img](https://user-gold-cdn.xitu.io/2020/5/14/172130840649cd87?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

##### æ–¹æ¡ˆäºŒ

- è§£å†³æ–¹æ¡ˆï¼šç›¸å…³æœåŠ¡çš„åœ°å€é…ç½®åœ¨ `package.json`ä¸­ï¼ŒåŒæ—¶ä¿®æ”¹é¡¹ç›®çš„ `webpack` é…ç½®ã€‚

- æ³¨ï¼šä¿®æ”¹é¡¹ç›®çš„ `webpack` é…ç½®éœ€è¦ eject é¡¹ç›®çš„ `webpack` é…ç½®ï¼ˆæ›´å¤šç»†èŠ‚å¯é˜…è¯» ğŸ‘‰ï¼š[react + typescript é¡¹ç›®çš„å®šåˆ¶åŒ–è¿‡ç¨‹](https://juejin.im/post/5d5e25b5f265da03970bbf82)ï¼‰ã€‚

- åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨

   

  ```
  yarn eject
  ```

   

  æˆåŠŸ eject å‡ºé…ç½®åï¼Œå¯ä»¥å‘ç°é¡¹ç›®ç›®å½•çš„å˜åŒ–å¦‚ä¸‹ï¼š

  ![img](https://user-gold-cdn.xitu.io/2020/5/14/17213101be031e97?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- å¦‚æœéœ€è¦å®šåˆ¶åŒ–é¡¹ç›®ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨

   

  ```
  config
  ```

   

  ç›®å½•ä¸‹å¯¹é»˜è®¤çš„

   

  ```
  webpack
  ```

   

  é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨

   

  ```
  config/path.js
  ```

   

  å’Œ

   

  ```
  config/env.js
  ```

   

  ä¸¤ä¸ªæ–‡ä»¶ï¼š

  - `env.js` çš„ä¸»è¦ç›®çš„åœ¨äºè¯»å– `env` é…ç½®æ–‡ä»¶å¹¶å°† `env` çš„é…ç½®ä¿¡æ¯ç»™åˆ°å…¨å±€å˜é‡ `process.env` ï¼›
  - `path.js` çš„ä¸»è¦ç›®çš„åœ¨äºä¸ºé¡¹ç›®æä¾›å„ç§è·¯å¾„ï¼ŒåŒ…æ‹¬æ„å»ºè·¯å¾„ã€ `public` è·¯å¾„ç­‰ã€‚

- ç”±äºæœ¬æ–‡çš„é‡ç‚¹ä¸æ˜¯å­¦ä¹  `webpack` é…ç½®ï¼Œè¿™é‡Œä»…ä»‹ç»å¦‚ä½•å®ç°ã€æ ¹æ®å¼€å‘ç¯å¢ƒé‡‡ç”¨ä¸åŒçš„å…¨å±€å˜é‡å€¼ã€‘çš„åŠŸèƒ½ã€‚

- é¦–å…ˆï¼Œéœ€è¦åœ¨ `package.json` ä¸­é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

```
"scripts": {
  "start": "NODE_ENV=development node scripts/start.js",
  "build": "NODE_ENV=production node scripts/build.js",
},
"sentryPath": {
  "dev": "https://test-sentry.xxx.com",
  "prod": "https://sentry.xxx.com"
 }
å¤åˆ¶ä»£ç 
```

- ç„¶åï¼Œä¿®æ”¹ `path.js` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
// é‡å†™ getPublicUrl æ–¹æ³•
const getPublicUrl = (appPackageJson, pathName) => {
  let path;
  switch (process.env.DEPLOY_ENV) {
    case 'development':
      path = require(appPackageJson)[pathName].dev;
      break;
    case 'production':
      path = require(appPackageJson)[pathName].prod;
      break;
    default:
      path = envPublicUrl || require(appPackageJson).homepage;
  }
  return path;
}

// æ–°å¢ getSentryPath æ–¹æ³•
const getSentryPath = (appPackageJson) => {
  return getPublicUrl(appPackageJson, 'sentryPath');
}

// config after eject: we're in ./config/
module.exports = {
  ...,
  sentryUrl: getSentryPath(resolveApp('package.json')), // æ–°å¢
};
å¤åˆ¶ä»£ç 
```

- æœ€åï¼Œä¿®æ”¹ `env.js` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
// ä¿®æ”¹ getClientEnvironment æ–¹æ³•
function getClientEnvironment(publicUrl) {
  const raw = Object.keys(process.env)
    .filter(key => REACT_APP.test(key))
    .reduce(
      (env, key) => {
        ...
      },
      {
        NODE_ENV: process.env.NODE_ENV || 'development',
        PUBLIC_URL: publicUrl,
        SENTRY_URL: paths.sentryUrl // æ–°å¢
      }
    );

  const stringified = {
    ...
  };
  return { raw, stringified };
}
å¤åˆ¶ä»£ç 
```

- é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­é€šè¿‡ `process.env.SENTRY_URL` è·å–åˆ° `sentry` æœåŠ¡çš„åœ°å€äº†ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”æ–¹æ¡ˆä¸€ç¹çï¼Œä½†æ˜¯è¿™ç§æ”¶ç›Šæ˜¯é•¿æœŸçš„ï¼Œå¦‚è¦æ–°å¢ä¸€ä¸ª `sonarqube` æœåŠ¡ï¼ŒåŒç†å®ç°å³å¯ï¼Œé€šè¿‡ä½¿ç”¨ `package.json` ä¹Ÿå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å½“å‰æœåŠ¡åœ¨ä¸åŒç¯å¢ƒä¸‹ä½¿ç”¨çš„åœ°å€ã€‚

## æ€»ç»“ ğŸ‘€

- æœ¬æ–‡ä»‹ç»äº† `package.json` çš„å¤šç§å¸¸è§çš„é…ç½®å­—æ®µåŠä½œç”¨ï¼Œå¹¶é€šè¿‡ä¾‹å­åŠ æ·±å¤§å®¶å¯¹ `package.json`è¿™äº›å­—æ®µçš„ç†è§£ã€‚
- é™¤äº†ä¸€äº›å¸¸ç”¨å­—æ®µï¼Œè¿˜ä»‹ç»äº†åœ¨`React` é¡¹ç›®ä¸­ `package.json` æ–‡ä»¶èƒ½å®ç°çš„ä¸€äº›åŠŸèƒ½è¿›è¡Œä»‹ç»ã€‚